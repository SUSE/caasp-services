# Spinnaker

[Spinnaker](https://www.spinnaker.io/) is an open source continuous delivery solution developed by Netflix. Spinnaker can deploy to mutiple clouds including Kubernetes.

## Deploying on CaaSP

There are two ways to deploy Spinnaker on Kubernetes: the Halyard tool or a Helm chart.

### Helm chart

The [Helm chart](https://github.com/kubernetes/charts/tree/master/stable/spinnaker) deploys successfully (minus a seemlingly inoccuous error) on CaaSP but uses outdated images for the [Spinnaker microservices](https://www.spinnaker.io/reference/architecture/).

### Halyard

[Halyard](https://github.com/spinnaker/halyard) is the official tool for Spinnaker deployment, configuration, and updating.

Halyard does not successfully deploy Spinnaker to CaasP due to a bug related to parsing the Kubernetes Config file generated by CaasP (see [Halyard issue #748](https://github.com/spinnaker/halyard/issues/748)).

#### Process

Prerequisites: Running CaaSP cluster with >= 8GB RAM, local kube config (`~/kube.config`)

1. Install Halyard via Docker
   - `mkdir ~/.hal`
   - `docker run -p 8084:8084 -p 9000:9000 --name halyard --rm -v ~/.hal:/root/.hal -v ~/.kube:/root/.kube --net=host gcr.io/spinnaker-marketplace/halyard:stable`
   - `docker exec -it halyard bash`
   - https://www.spinnaker.io/setup/install/halyard/#docker
2. Configure persistent storage with Redis
   - https://www.spinnaker.io/setup/storage/redis/
3. Configure Docker registry
   - https://www.spinnaker.io/setup/providers/docker-registry/
4. Configure Kubernetes Provider
   - https://www.spinnaker.io/setup/providers/kubernetes/
5. Set the Spinnaker version to deploy
   - https://www.spinnaker.io/reference/halyard/commands/#hal-config-version-edit
6. Deploy Spinnaker
   - https://www.spinnaker.io/reference/halyard/commands/#hal-deploy-apply
   - This is when the bug occurs - to be continued
    
